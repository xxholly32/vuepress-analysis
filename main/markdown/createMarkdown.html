<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>createMarkdown 解析 | vuepress-analysis</title>
    <meta name="description" content="let&#96;s play vuepress">
    
    
    <link rel="preload" href="/vuepress-analysis/assets/css/0.styles.68b28458.css" as="style"><link rel="preload" href="/vuepress-analysis/assets/js/app.689ea931.js" as="script"><link rel="preload" href="/vuepress-analysis/assets/js/2.f70505e4.js" as="script"><link rel="preload" href="/vuepress-analysis/assets/js/8.af8565ed.js" as="script"><link rel="prefetch" href="/vuepress-analysis/assets/js/10.9f51aae6.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/11.529ada24.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/12.beb3bf1e.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/13.30f7647c.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/14.a84efeba.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/15.1dd2c079.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/16.696e11c8.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/17.8c617111.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/18.73bb2cd5.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/19.f87e8083.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/20.4d58a564.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/21.ba70151b.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/22.8b66d223.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/23.6bed722f.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/24.4577fbd3.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/25.278ff8d3.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/26.7c36c41a.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/3.63a46429.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/4.11d613bd.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/5.65294d90.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/6.d2b044b6.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/7.e542f2ff.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/9.2b38ef71.js">
    <link rel="stylesheet" href="/vuepress-analysis/assets/css/0.styles.68b28458.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-analysis/" class="home-link router-link-active"><!----> <span class="site-name">vuepress-analysis</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress-analysis/" class="nav-link">首页</a></div><div class="nav-item"><a href="/vuepress-analysis/plugin/pluginAPI.html" class="nav-link">插件</a></div><div class="nav-item"><a href="/vuepress-analysis/theme/theme-analysis.html" class="nav-link">主题</a></div><div class="nav-item"><a href="https://v1.vuepress.vuejs.org/zh" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vuepress官网
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/xxholly32/vuepress-analysis" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepress-analysis/" class="nav-link">首页</a></div><div class="nav-item"><a href="/vuepress-analysis/plugin/pluginAPI.html" class="nav-link">插件</a></div><div class="nav-item"><a href="/vuepress-analysis/theme/theme-analysis.html" class="nav-link">主题</a></div><div class="nav-item"><a href="https://v1.vuepress.vuejs.org/zh" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vuepress官网
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/xxholly32/vuepress-analysis" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>开始</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-analysis/main/start/cli.html" class="sidebar-link">cli 指令</a></li><li><a href="/vuepress-analysis/main/start/require.html" class="sidebar-link">相关工具</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>cli 命令</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-analysis/main/cli/start.html" class="sidebar-link">dev 命令</a></li><li><a href="/vuepress-analysis/main/cli/dev.html" class="sidebar-link">dev 流程解析</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>markdown 解析</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-analysis/main/markdown/createMarkdown.html" class="active sidebar-link">createMarkdown 解析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-analysis/main/markdown/createMarkdown.html#markdown-it" class="sidebar-link">markdown-it</a></li><li class="sidebar-sub-header"><a href="/vuepress-analysis/main/markdown/createMarkdown.html#代码块" class="sidebar-link">代码块</a></li><li class="sidebar-sub-header"><a href="/vuepress-analysis/main/markdown/createMarkdown.html#识别-vue-标签插件" class="sidebar-link">识别 vue 标签插件</a></li><li class="sidebar-sub-header"><a href="/vuepress-analysis/main/markdown/createMarkdown.html#代码行高亮" class="sidebar-link">代码行高亮</a></li><li class="sidebar-sub-header"><a href="/vuepress-analysis/main/markdown/createMarkdown.html#预加载容器" class="sidebar-link">预加载容器</a></li><li class="sidebar-sub-header"><a href="/vuepress-analysis/main/markdown/createMarkdown.html#导入代码片段功能" class="sidebar-link">导入代码片段功能</a></li><li class="sidebar-sub-header"><a href="/vuepress-analysis/main/markdown/createMarkdown.html#链接解析" class="sidebar-link">链接解析</a></li><li class="sidebar-sub-header"><a href="/vuepress-analysis/main/markdown/createMarkdown.html#hoist-解析文档中的语言标签" class="sidebar-link">hoist 解析文档中的语言标签</a></li><li class="sidebar-sub-header"><a href="/vuepress-analysis/main/markdown/createMarkdown.html#markdown-it-emoji" class="sidebar-link">markdown-it-emoji</a></li><li class="sidebar-sub-header"><a href="/vuepress-analysis/main/markdown/createMarkdown.html#markdown-it-anchor" class="sidebar-link">markdown-it-anchor</a></li><li class="sidebar-sub-header"><a href="/vuepress-analysis/main/markdown/createMarkdown.html#markdown-it-table-of-contents" class="sidebar-link">markdown-it-table-of-contents</a></li><li class="sidebar-sub-header"><a href="/vuepress-analysis/main/markdown/createMarkdown.html#总结" class="sidebar-link">总结</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>pages 解析</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-analysis/main/pages/resolvePages.html" class="sidebar-link">resolvePages 解析</a></li><li><a href="/vuepress-analysis/main/pages/internal-routes.html" class="sidebar-link">routes 关联 pages 解析</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>webpack 配置解析</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-analysis/main/webpack/configAnalysis.html" class="sidebar-link">webpack 配置</a></li><li><a href="/vuepress-analysis/main/webpack/createServer.html" class="sidebar-link">createServer</a></li><li><a href="/vuepress-analysis/main/webpack/webpackconfig.html" class="sidebar-link">webpackconfig</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="createmarkdown-解析"><a href="#createmarkdown-解析" aria-hidden="true" class="header-anchor">#</a> createMarkdown 解析</h1> <h2 id="markdown-it"><a href="#markdown-it" aria-hidden="true" class="header-anchor">#</a> markdown-it</h2> <p>markdown-it 辅助 markdown 的库，和 es 类似，将 md 文件的语言转化成 html 的语言，比如</p> <div class="language- extra-class"><pre class="language-text"><code># hello-world or

md.render('# markdown-it rulezz!');

# result
# &lt;h1&gt;hello world&lt;/h1&gt;
</code></pre></div><p>这个逻辑和 es/tslint 一样，都有各自的规则，只不过 es/tslint 是将 es/ts 语言转化成 js，根据规则可以生产对应的 html 文件</p> <div class="tip custom-block"><p>markdown-it 的文档理解起来会比较费劲，虽然已经有大神做了<a href="https://markdown-it.docschina.org" target="_blank" rel="noopener noreferrer">整体翻译<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，但还是无法理解的很全。一开始看 markdown 的同学可以看下相关的<a href="https://www.jianshu.com/p/a2c7cd1cabc7" target="_blank" rel="noopener noreferrer">源码解析<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <p>下面主要分析一下 vuepress 内置的一些 markdown 插件和一些个人理解,但实现代码我粗略看了下，过于复杂，就不细分析了，只是说下做了哪些功能和一些实现精髓，具体功能可以用测试代码来反推实现。</p> <blockquote><p>vuepress 中 <a href="https://github.com/vuejs/vuepress/blob/master/packages/%40vuepress/markdown/index.js" target="_blank" rel="noopener noreferrer">markdown 的主源码引入的 markdown-it 插件库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h2 id="代码块"><a href="#代码块" aria-hidden="true" class="header-anchor">#</a> 代码块</h2> <div class="language-js extra-class"><pre class="language-js"><code>md<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span>

# 输出

exports<span class="token punctuation">[</span><span class="token template-string"><span class="token string">`highlight should highlight code 1`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token string">`

&lt;pre v-pre class=&quot;language-js&quot;&gt;
&lt;code&gt;
&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;Vue&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;
&lt;/pre&gt;
`</span></span>
</code></pre></div><p>代码高亮 这里用的是 <code>prismjs</code>， markdown-it 官方推荐的是 <code>highlight.js</code></p> <div class="tip custom-block"><p>测试代码反推实现</p> <p>用测试反推实现是另一种理解 api 的方法，而且非常好用，你不用去了解代码，你会直接知道是怎么实现的，具体我们可以参考<a href="https://www.bilibili.com/video/av44802599" target="_blank" rel="noopener noreferrer">sorrycc 的分享 通过写测试用例学习前端知识<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>我们这里可以直接参考<a href="https://github.com/vuejs/vuepress/blob/master/packages/%40vuepress/markdown/__tests__/__snapshots__/highlight.spec.js.snap" target="_blank" rel="noopener noreferrer">相关用例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>结合测试一起看代码高亮的实现</p></div> <h2 id="识别-vue-标签插件"><a href="#识别-vue-标签插件" aria-hidden="true" class="header-anchor">#</a> 识别 vue 标签插件</h2> <p>重写官方 html_block 方法</p> <p>这个插件是重写了官方的 <a href="https://github.com/markdown-it/markdown-it/blob/1ad3aec2041cd2defa7e299543cc1e42184b680d/lib/rules_block/html_block.js" target="_blank" rel="noopener noreferrer">html_block<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 插件，不同的是以下 2 行代码</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">HTML_SEQUENCES</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token regex">/^&lt;(script|pre|style)(?=(\s|&gt;|$))/i</span><span class="token punctuation">,</span> <span class="token regex">/&lt;\/(script|pre|style)&gt;/i</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/^&lt;!--/</span><span class="token punctuation">,</span> <span class="token regex">/--&gt;/</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/^&lt;\?/</span><span class="token punctuation">,</span> <span class="token regex">/\?&gt;/</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/^&lt;![A-Z]/</span><span class="token punctuation">,</span> <span class="token regex">/&gt;/</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/^&lt;!\[CDATA\[/</span><span class="token punctuation">,</span> <span class="token regex">/\]\]&gt;/</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// PascalCase Components</span>
  <span class="token punctuation">[</span><span class="token regex">/^&lt;[A-Z]/</span><span class="token punctuation">,</span> <span class="token regex">/&gt;/</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// custom elements with hyphens</span>
  <span class="token punctuation">[</span><span class="token regex">/^&lt;\w+\-/</span><span class="token punctuation">,</span> <span class="token regex">/&gt;/</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">&quot;^&lt;/?(&quot;</span> <span class="token operator">+</span> blockNames<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;|&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;)(?=(\\s|/?&gt;|$))&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;i&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token regex">/^$/</span><span class="token punctuation">,</span>
    <span class="token boolean">true</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token constant">HTML_OPEN_CLOSE_TAG_RE</span><span class="token punctuation">.</span>source <span class="token operator">+</span> <span class="token string">&quot;\\s*$&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token regex">/^$/</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>加入了<a href="https://baike.baidu.com/item/%E5%B8%95%E6%96%AF%E5%8D%A1%E5%91%BD%E5%90%8D%E6%B3%95/9464494?fr=aladdin" target="_blank" rel="noopener noreferrer">PascalCase Components 帕斯卡<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>写法，和 vue 标准规范中带连接符的控件；</p> <h2 id="代码行高亮"><a href="#代码行高亮" aria-hidden="true" class="header-anchor">#</a> 代码行高亮</h2> <p>对以后的 highlight 中对指定行进行高亮，<a href="https://v1.vuepress.vuejs.org/zh/guide/markdown.html#%E4%BB%A3%E7%A0%81%E5%9D%97%E4%B8%AD%E7%9A%84%E8%A1%8C%E9%AB%98%E4%BA%AE" target="_blank" rel="noopener noreferrer">官方章节<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-js extra-class"><pre class="language-js"><code>js <span class="token punctuation">{</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  render<span class="token punctuation">,</span>
  router
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>

# 输出

exports<span class="token punctuation">[</span><span class="token template-string"><span class="token string">`highlightLines highlight multiple lines 1`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token string">`
&lt;div class=&quot;highlight-lines&quot;&gt;
  &lt;div class=&quot;highlighted&quot;&gt;&amp;nbsp;&lt;/div&gt;
  &lt;div class=&quot;highlighted&quot;&gt;&amp;nbsp;&lt;/div&gt;&lt;br&gt;
  &lt;div class=&quot;highlighted&quot;&gt;&amp;nbsp;&lt;/div&gt;
  &lt;div class=&quot;highlighted&quot;&gt;&amp;nbsp;&lt;/div&gt;&lt;br&gt;&lt;br&gt;
&lt;/div&gt;const app = new Vue({
render,
router
})

app.$mount('#app')
`</span></span><span class="token punctuation">;</span>
</code></pre></div><p>这边有 3 个 br，4 个 div，div 就是高亮的代码 br 就是空出来的代码；其实会多套一层 html 元素</p> <h2 id="预加载容器"><a href="#预加载容器" aria-hidden="true" class="header-anchor">#</a> 预加载容器</h2> <p>这块官方并没有文档，对于不同语言的文件外层会包一层 <code>&lt;div class=&quot;language-${type} extra-class&quot;&gt;&lt;/div&gt;</code>可以用来区分样式的不同</p> <h2 id="导入代码片段功能"><a href="#导入代码片段功能" aria-hidden="true" class="header-anchor">#</a> 导入代码片段功能</h2> <p>从文件中读取代码片段，支持本地文件上传，<a href="https://v1.vuepress.vuejs.org/zh/guide/markdown.html#%E5%AF%BC%E5%85%A5%E4%BB%A3%E7%A0%81%E6%AE%B5" target="_blank" rel="noopener noreferrer">官方使用说明<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>具体实现其实就是导入文件中的内容在进行操作，因为 markdown-it 不是支持异步的，但 fs.readFileSync 居然读文件是有同步的方法。</p> <h2 id="链接解析"><a href="#链接解析" aria-hidden="true" class="header-anchor">#</a> 链接解析</h2> <p>链接解析官方<a href="https://v1.vuepress.vuejs.org/zh/guide/markdown.html#%E5%86%85%E9%83%A8%E9%93%BE%E6%8E%A5" target="_blank" rel="noopener noreferrer">文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>外联的链接都带上 <code>&lt;OutboundLink /&gt;</code></p> <p>内联的文件关联单元测试表</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> internalLinkAsserts <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// START abosolute path usage</span>
  <span class="token string">&quot;/&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>

  <span class="token string">&quot;/foo/&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;/foo/&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;/foo/#hash&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;/foo/#hash&quot;</span><span class="token punctuation">,</span>

  <span class="token string">&quot;/foo/two.md&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;/foo/two.html&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;/foo/two.html&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;/foo/two.html&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// END abosolute path usage</span>

  <span class="token comment">// START relative path usage</span>
  <span class="token string">&quot;README.md&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;./README.md&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span>

  <span class="token string">&quot;index.md&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;./index.md&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span>

  <span class="token string">&quot;one.md&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;./one.html&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;./one.md&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;./one.html&quot;</span><span class="token punctuation">,</span>

  <span class="token string">&quot;foo/README.md&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;./foo/&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;./foo/README.md&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;./foo/&quot;</span><span class="token punctuation">,</span>

  <span class="token string">&quot;foo/README.md#hash&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;./foo/#hash&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;./foo/README.md#hash&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;./foo/#hash&quot;</span><span class="token punctuation">,</span>

  <span class="token string">&quot;../README.md&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;./../&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;../README.md#hash&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;./../#hash&quot;</span><span class="token punctuation">,</span>

  <span class="token string">&quot;../foo.md&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;./../foo.html&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;../foo.md#hash&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;./../foo.html#hash&quot;</span><span class="token punctuation">,</span>

  <span class="token string">&quot;../foo/one.md&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;./../foo/one.html&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;../foo/one.md#hash&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;./../foo/one.html#hash&quot;</span>
  <span class="token comment">// END relative path usage</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>对于以前的用法内联 md 的 hash 特殊处理一开始还是不知道的</p> <h2 id="hoist-解析文档中的语言标签"><a href="#hoist-解析文档中的语言标签" aria-hidden="true" class="header-anchor">#</a> hoist 解析文档中的语言标签</h2> <p>这个内部变量是解析 script 和 style 并从文档中分离的。看下测试代码</p> <div class="language-js extra-class"><pre class="language-js"><code># hoist<span class="token punctuation">.</span>md
# <span class="token constant">H1</span>

<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;vue.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
  <span class="token punctuation">.</span>vue <span class="token punctuation">{</span>
    font<span class="token operator">-</span>size<span class="token punctuation">:</span> <span class="token number">16</span>px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>

## <span class="token constant">H2</span>


<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;Should miss script and style when using hoist&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token function">getFragment</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;hoist.md&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> html<span class="token punctuation">,</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> mdH<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

# 输出
exports<span class="token punctuation">[</span><span class="token template-string"><span class="token string">`hoist Should miss script and style when using hoist 1`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token string">`
&lt;h1&gt;H1&lt;/h1&gt;
&lt;h2&gt;H2&lt;/h2&gt;
`</span></span><span class="token punctuation">;</span>

exports<span class="token punctuation">[</span><span class="token template-string"><span class="token string">`hoist Should miss script and style when using hoist 2`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token string">`
Object {
  &quot;__data_block&quot;: Object {},
  &quot;hoistedTags&quot;: Array [
    &lt;script src=&quot;vue.js&quot;&gt;&lt;/script&gt;,
    &lt;style&gt;
  .vue {
    font-size: 16px;
  }
&lt;/style&gt;,
  ],
}
`</span></span><span class="token punctuation">;</span>
</code></pre></div><p>md 的 html_block 功能只能返回最终展示的 html，但 md.$data 支持将 script 和 style 代码数据储存到实例中，供后续使用。</p> <h2 id="markdown-it-emoji"><a href="#markdown-it-emoji" aria-hidden="true" class="header-anchor">#</a> markdown-it-emoji</h2> <p>emoji 图标生成<a href="https://github.com/markdown-it/markdown-it-emoji" target="_blank" rel="noopener noreferrer">markdown-it-emoji<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，emoji 配置相关 <a href="https://github.com/markdown-it/markdown-it-emoji/blob/master/lib/data/full.json" target="_blank" rel="noopener noreferrer">json 文件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="markdown-it-anchor"><a href="#markdown-it-anchor" aria-hidden="true" class="header-anchor">#</a> markdown-it-anchor</h2> <p>标签生成 header-anchor 链接，用的是 markdown 的插件 <a href="https://github.com/valeriangalliat/markdown-it-anchor/blob/master/index.js" target="_blank" rel="noopener noreferrer">markdown-it-anchor<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="markdown-it-table-of-contents"><a href="#markdown-it-table-of-contents" aria-hidden="true" class="header-anchor">#</a> markdown-it-table-of-contents</h2> <p><a href="https://v1.vuepress.vuejs.org/zh/guide/markdown.html#%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener noreferrer">toc 目录<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 功能参考的是一个 markdown-it 插件，<a href="https://github.com/Oktavilla/markdown-it-table-of-contents/blob/master/index.js" target="_blank" rel="noopener noreferrer">markdown-it-table-of-contents<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>这个对于单 markdown 的长文件来说以前比如用马克飞象的时候是挺好用的，但在 vuepress 可以用多 markdown 文件个人感觉还是比较累赘的。因为原生的路由已经实现的减少又长又臭的 markdown 文件。</p> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p>作者在这里提炼了<code>markdown-it-chain</code>类似<code>webpack-chain</code>功能的插件，并提炼出来供项目使用，相关<code>markdown-it-xxx</code>的插件也可以根据相关配置串联并组合成一个<code>chain</code>，不得不说<code>chain</code>配置真的是个好东西；</p> <blockquote><p>说明，createMarkdown 最终返回的是<code>markdown-it</code>实例</p></blockquote> <ul><li>TODO：
<ul><li>实现一个 markdown-it 插件</li></ul></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/vuepress-analysis/main/cli/dev.html" class="prev">
          dev 流程解析
        </a></span> <span class="next"><a href="/vuepress-analysis/main/pages/resolvePages.html">
          resolvePages 解析
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vuepress-analysis/assets/js/app.689ea931.js" defer></script><script src="/vuepress-analysis/assets/js/2.f70505e4.js" defer></script><script src="/vuepress-analysis/assets/js/8.af8565ed.js" defer></script>
  </body>
</html>
