<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>plugin | vuepress-analysis</title>
    <meta name="description" content="let&#96;s play vuepress">
    
    
    <link rel="preload" href="/vuepress-analysis/assets/css/0.styles.68b28458.css" as="style"><link rel="preload" href="/vuepress-analysis/assets/js/app.689ea931.js" as="script"><link rel="preload" href="/vuepress-analysis/assets/js/2.f70505e4.js" as="script"><link rel="preload" href="/vuepress-analysis/assets/js/24.4577fbd3.js" as="script"><link rel="prefetch" href="/vuepress-analysis/assets/js/10.9f51aae6.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/11.529ada24.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/12.beb3bf1e.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/13.30f7647c.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/14.a84efeba.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/15.1dd2c079.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/16.696e11c8.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/17.8c617111.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/18.73bb2cd5.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/19.f87e8083.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/20.4d58a564.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/21.ba70151b.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/22.8b66d223.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/23.6bed722f.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/25.278ff8d3.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/26.7c36c41a.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/3.63a46429.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/4.11d613bd.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/5.65294d90.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/6.d2b044b6.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/7.e542f2ff.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/8.af8565ed.js"><link rel="prefetch" href="/vuepress-analysis/assets/js/9.2b38ef71.js">
    <link rel="stylesheet" href="/vuepress-analysis/assets/css/0.styles.68b28458.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-analysis/" class="home-link router-link-active"><!----> <span class="site-name">vuepress-analysis</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress-analysis/" class="nav-link">首页</a></div><div class="nav-item"><a href="/vuepress-analysis/plugin/pluginAPI.html" class="nav-link router-link-exact-active router-link-active">插件</a></div><div class="nav-item"><a href="/vuepress-analysis/theme/theme-analysis.html" class="nav-link">主题</a></div><div class="nav-item"><a href="https://v1.vuepress.vuejs.org/zh" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vuepress官网
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/xxholly32/vuepress-analysis" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepress-analysis/" class="nav-link">首页</a></div><div class="nav-item"><a href="/vuepress-analysis/plugin/pluginAPI.html" class="nav-link router-link-exact-active router-link-active">插件</a></div><div class="nav-item"><a href="/vuepress-analysis/theme/theme-analysis.html" class="nav-link">主题</a></div><div class="nav-item"><a href="https://v1.vuepress.vuejs.org/zh" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vuepress官网
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/xxholly32/vuepress-analysis" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/vuepress-analysis/plugin/" class="sidebar-heading clickable router-link-active open"><span>插件系统分析</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-analysis/plugin/pluginAPI.html" class="active sidebar-link">plugin</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-analysis/plugin/pluginAPI.html#官方理念解读" class="sidebar-link">官方理念解读</a></li><li class="sidebar-sub-header"><a href="/vuepress-analysis/plugin/pluginAPI.html#所有插件对外接口" class="sidebar-link">所有插件对外接口</a></li><li class="sidebar-sub-header"><a href="/vuepress-analysis/plugin/pluginAPI.html#plugin-底层设计" class="sidebar-link">plugin 底层设计</a></li><li class="sidebar-sub-header"><a href="/vuepress-analysis/plugin/pluginAPI.html#总结" class="sidebar-link">总结</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/vuepress-analysis/plugin/" class="sidebar-heading clickable router-link-active"><span>插件扩展类型</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-analysis/plugin/AliasOption.html" class="sidebar-link">AliasOption</a></li><li><a href="/vuepress-analysis/plugin/DefineOption.html" class="sidebar-link">DefineOption</a></li><li><a href="/vuepress-analysis/plugin/ClientDynamicModulesOption.html" class="sidebar-link">ClientDynamicModulesOption</a></li><li><a href="/vuepress-analysis/plugin/EnhanceAppFilesOptions.html" class="sidebar-link">EnhanceAppFilesOptions</a></li><li><a href="/vuepress-analysis/plugin/GlobalUIComponentsOption.html" class="sidebar-link">GlobalUIComponentsOption</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/vuepress-analysis/plugin/" class="sidebar-heading clickable router-link-active"><span>内置插件</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-analysis/plugin/internal-layout-components.html" class="sidebar-link">internal-layout-components</a></li><li><a href="/vuepress-analysis/plugin/internal-page-components.html" class="sidebar-link">internal-page-components</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="plugin"><a href="#plugin" aria-hidden="true" class="header-anchor">#</a> plugin</h1> <h2 id="官方理念解读"><a href="#官方理念解读" aria-hidden="true" class="header-anchor">#</a> 官方理念解读</h2> <p><a href="https://v1.vuepress.vuejs.org/zh/plugin/" target="_blank" rel="noopener noreferrer">插件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，在不看源码只看功能，我的理解是做一些配置，加入一些<code>UI</code>等功能。但代码中巧妙的将所有的功能都做成了插件，有些只是内部插件，看起来是 vuepress 一体的，但内部还是通过引入插件的方式去完成的。官方也有附图去说明了一些现有的插件功能。</p> <p>首先我们看官方的说明图</p> <p><img src="/architecture.png" alt="an image"></p> <p>插件这边主要拆成 2 部分</p> <ul><li>browser
<ul><li>user interface 用户特殊页面功能</li> <li>client addons 客户端插件</li></ul></li> <li>nodejs
<ul><li>build process 构建配置插件</li> <li>User project 用户配合以及 markdown 文件</li> <li>theme 主题系统</li></ul></li></ul> <h2 id="所有插件对外接口"><a href="#所有插件对外接口" aria-hidden="true" class="header-anchor">#</a> 所有插件对外接口</h2> <p>插件应该是 vuepress 中最最最最核心的部分，部分核心代码也是插件的形式去做的，来看下 core 中的代码</p> <div class="language- extra-class"><pre class="language-text"><code>// 所有在plugin的属性名和类型
const PLUGIN_OPTION_META_MAP = {
  // hooks
  READY: { name: 'ready', types: [Function], async: true },
  COMPILED: { name: 'compiled', types: [Function] },
  UPDATED: { name: 'updated', types: [Function] },
  GENERATED: { name: 'generated', types: [Function], async: true },
  // options
  # client Addons
  ENHANCE_APP_FILES: { name: 'enhanceAppFiles', types: [String, Object, Array, Function] },
  CLIENT_ROOT_MIXIN: { name: 'clientRootMixin', types: [String] },
  # build process
  CHAIN_WEBPACK: { name: 'chainWebpack', types: [Function] },
  EXTEND_PAGE_DATA: { name: 'extendPageData', types: [Function] },
  EXTEND_MARKDOWN: { name: 'extendMarkdown', types: [Function] },
  CHAIN_MARKDOWN: { name: 'chainMarkdown', types: [Function] },
  CLIENT_DYNAMIC_MODULES: { name: 'clientDynamicModules', types: [Object, Function] },
  BEFORE_DEV_SERVER: { name: 'beforeDevServer', types: [Function] },
  AFTER_DEV_SERVER: { name: 'afterDevServer', types: [Function] },
  DEFINE: { name: 'define', types: [Function, Object] },
  ALIAS: { name: 'alias', types: [Function, Object] },
  # User project
  ADDITIONAL_PAGES: { name: 'additionalPages', types: [Function, Array], async: true },
  # User interface
  GLOBAL_UI_COMPONENTS: { name: 'globalUIComponents', types: [String, Array] },

  // other
  OUT_FILES: { name: 'outFiles', types: [Object] },
  EXTEND_CLI: { name: 'extendCli', types: [Function] }
}
</code></pre></div><h3 id="hook"><a href="#hook" aria-hidden="true" class="header-anchor">#</a> hook</h3> <p>这边其实还存在一些钩子，在整个系统的关键过程中处理一些特殊用户行为，比如加入 pwa 等了；所以 <code>type</code> 都是 function</p> <h3 id="theme"><a href="#theme" aria-hidden="true" class="header-anchor">#</a> theme</h3> <p>皮肤这块构架会相对复杂，没有单独的 theme internal 模块，但单个插件包含各个插件中，可以看下官方的 <a href="https://github.com/vuejs/vuepress/blob/master/packages/%40vuepress/theme-default/index.js" target="_blank" rel="noopener noreferrer">theme-default<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="plugin-底层设计"><a href="#plugin-底层设计" aria-hidden="true" class="header-anchor">#</a> plugin 底层设计</h2> <h3 id="对外接口类设计"><a href="#对外接口类设计" aria-hidden="true" class="header-anchor">#</a> 对外接口类设计</h3> <p>分这么几种类型基础的 2 种 <code>Option</code> 和 <code>AsyncOption</code>, 一个是普通一个是需要异步的, 就像上面说的， <code>webpack</code> 配置一般用同步，有些文件处理用异步的。</p> <p>以下是初始化 plugin option 的方法，主要用用 7 中类型</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">instantiateOption</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> name<span class="token punctuation">,</span> async <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token constant">PLUGIN_OPTION_MAP</span><span class="token punctuation">.</span><span class="token constant">ENHANCE_APP_FILES</span><span class="token punctuation">.</span>name<span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">EnhanceAppFilesOption</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> <span class="token constant">PLUGIN_OPTION_MAP</span><span class="token punctuation">.</span><span class="token constant">CLIENT_DYNAMIC_MODULES</span><span class="token punctuation">.</span>name<span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ClientDynamicModulesOption</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> <span class="token constant">PLUGIN_OPTION_MAP</span><span class="token punctuation">.</span><span class="token constant">GLOBAL_UI_COMPONENTS</span><span class="token punctuation">.</span>name<span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">GlobalUIComponentsOption</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> <span class="token constant">PLUGIN_OPTION_MAP</span><span class="token punctuation">.</span><span class="token constant">DEFINE</span><span class="token punctuation">.</span>name<span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DefineOption</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> <span class="token constant">PLUGIN_OPTION_MAP</span><span class="token punctuation">.</span><span class="token constant">ALIAS</span><span class="token punctuation">.</span>name<span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AliasOption</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> async <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">AsyncOption</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Option</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>其实所有的都是继承与 Option 这个类，<code>async</code> 也是；那么 option 类主要暴露的是什么接口</p> <blockquote><p>option 类暴露接口的一个设计点，部分暴露的是异步，一些是同步的，这边统一暴露成 apply，只是在继承以后再将赋值的暴露给 apply
<code>Option.prototype.apply = Option.prototype.syncApply;</code> and <code>AsyncOption.prototype.apply = AsyncOption.prototype.asyncApply</code></p></blockquote> <p>apply 将所有插件和内置插件的参数，方法都整合到一起</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">syncApply</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> rawItems <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items
  <span class="token keyword">this</span><span class="token punctuation">.</span>items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>appliedItems <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> value <span class="token punctuation">}</span> <span class="token keyword">of</span> rawItems<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
        name<span class="token punctuation">,</span>
        <span class="token function">isFunction</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
          <span class="token operator">?</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token comment">// async: awati value(...args)</span>
          <span class="token punctuation">:</span> value
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> apply </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> failed.`</span></span><span class="token punctuation">)</span>
      <span class="token keyword">throw</span> error
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>items <span class="token operator">=</span> rawItems
<span class="token punctuation">}</span>

<span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>value<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> value<span class="token punctuation">:</span> i<span class="token punctuation">,</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> value<span class="token punctuation">,</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里设计就有个拆分，用户输入是单个插件，调用多个接口，在用户层面上非常好理解，但项目中是对应多个接口所以实现上做了一层转化；转变为项目中单个接口对应多个插件，储存的是 [{name:&quot;plugin-a&quot;,value:any},{name:&quot;plugin-a&quot;,value:any} ...]。一点是理解上顺畅，还有一点是解耦，如果 vuepress 在单独出一个接口，并不会影响之前的插件系统。</p> <p>还有一点设计巧妙的是 ayncApply 只需要改一处地方就生效，而且对外暴露接口都是 plugin.apply。</p> <p>其他的继承与 <code>option</code> 的 5 个插件单独开了章节说明了下具体的内容，具体见后面章节。</p> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p>插件化是 vuepress 的主要设计理念，在关键模块的关键过程中引入了对应的对外接口，并加入了扩展的设计，并结合内部的 internal-plugin 配置去实现；1.0 也是讲插件系统做深入，把主题和布局抽离出来；还有一个理念是合理的优先级管理，用户的配置会高于默认的配置，</p> <div class="tip custom-block"><p>webpack 的 plugin 和 vuepress 的类似，这里推荐一个<a href="https://www.webpackjs.com/contribute/writing-a-plugin/#%E5%9F%BA%E6%9C%AC%E6%8F%92%E4%BB%B6%E6%9E%B6%E6%9E%84aa" target="_blank" rel="noopener noreferrer">webpack 的官方文献<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>；区别是 webpack 没有 apply 的 async 操作，是用 callback 去实现的。</p></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/vuepress-analysis/plugin/AliasOption.html">
          AliasOption
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vuepress-analysis/assets/js/app.689ea931.js" defer></script><script src="/vuepress-analysis/assets/js/2.f70505e4.js" defer></script><script src="/vuepress-analysis/assets/js/24.4577fbd3.js" defer></script>
  </body>
</html>
